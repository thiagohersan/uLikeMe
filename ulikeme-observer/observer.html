<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>uLikeMe (on Facebook)</title>
  <meta name="description" content="uLikeMe (on Facebook) is an app for allowing other people to love you (on Facebook)">
  <link href='http://fonts.googleapis.com/css?family=Lato:100,300,400,700' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700,800' rel='stylesheet' type='text/css'>
  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
  <link rel="stylesheet" type="text/css" href="css.css" />

  <meta property="og:title" content="uLikeMe (on Facebook)" />
  <meta property="og:type" content="article" />
  <meta property="og:url" content="http://www.thiagohersan.com/uLikeMe/" />
  <meta property="og:image" content="http://www.thiagohersan.com/uLikeMe/imgs/uLikeMe500.png" />
  <meta property="og:description" content="uLikeMe (on Facebook) is an app for allowing other people to love you (on Facebook)" />

</head>
<body>
  <div id="fb-root"></div>
  <script>

  var myWebSocket;
  // Load the SDK asynchronously
  (function(d){
    var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
    if (d.getElementById(id)) {return;}
    js = d.createElement('script'); js.id = id; js.async = true;
    js.src = "//connect.facebook.net/en_US/all.js";
    ref.parentNode.insertBefore(js, ref);
  }(document));

  window.fbAsyncInit = function() {
    FB.init({
      appId      : '499753440145658',
      status     : true, // check login status
      cookie     : true, // enable cookies to allow the server to access the session
      xfbml      : true  // parse XFBML
    });

    FB.Event.subscribe('auth.authResponseChange', function(response) {
      if (response.status == 'connected') {
        myId = response.authResponse.userID;
        onLogIn(response);
      }
    });
  };

  function logMeIn(){
    FB.login(function(){}, {scope: "read_stream,user_likes,publish_actions,publish_stream"});
  }
  function onLogIn(response) {
    if(('status' in response) && (response.status == 'connected')){
      // connect to heroku app, get list of clients
      myWebSocket = new WebSocket("ws://ulikeme-server.herokuapp.com/observer");
      myWebSocket.onmessage = function (event) {
        if('data' in event){
          var data = JSON.parse(event.data);
          if('clientIds' in data){
            var clientIds = data['clientIds'];
            /* TODO:
              1. make client selector
            */
            console.log(clientIds);
          }
        }
        /* TODO: on client info request response:
          1. post something to FB ??
        */
      };
    }
  }

  $(window).load(function(){
    $('#roll-over-area').hover(
      function(){ $('#eye-img').attr("src","imgs/uLikeMe666.png"); },
      function() { $('#eye-img').attr("src","imgs/uLikeMe666_.png"); }
      );
  });
  </script>

  <div id="main-body">
    <div id="logo-button">
      <img id="eye-img" src="imgs/uLikeMe666_.png" usemap="#imgmap" />
      <map name="imgmap">
        <area id="roll-over-area" shape="circle" coords="333,333,166" onclick="logMeIn()" >
      </map>
    </div>
  </div>

  <div class="fb-like"
    id="fb-like"
    data-href="http://www.thiagohersan.com/uLikeMe"
    data-layout="box_count"
    data-action="like"
    data-show-faces="false"
    data-share="false">
  </div>

  <div id="about" class="bottom-links">
    <a href="http://www.thiagohersan.com/project/ilikeyou-on-facebook-2013/" target="_about">Info</a>
  </div>

  <div id="credit" class="bottom-links">
    <a href="http://www.thiagohersan.com/" target="_credit">Thiago Hersan</a>
  </div>

</body>
</html>
